const pokemonRepository=function(){const e=[];function t(t){t&&"object"==typeof t&&"name"in t&&"detailsUrl"in t?e.push(t):console.error("Invalid Pokémon format.")}function n(e){return fetch(e.detailsUrl).then(e=>e.json()).then(t=>{e.imgUrl=t.sprites?.front_default||"",e.bigImgUrl=t.sprites?.other?.["official-artwork"]?.front_default||e.imgUrl,e.height=t.height,e.weight=t.weight,e.types=(t.types||[]).map(e=>capitalize(e.type.name))}).catch(e=>console.error("Failed to load Pokémon details:",e))}return{getAll:function(){return e},add:t,loadList:function(){return fetch("https://pokeapi.co/api/v2/pokemon/?limit=150").then(e=>e.json()).then(e=>{e.results.forEach(e=>{t({name:e.name,detailsUrl:e.url})})}).catch(e=>console.error("Failed to load Pokémon list:",e))},loadDetails:n,showDetails:function(e){const t=document.getElementById("pokemonModalLabel"),o=document.getElementById("modalImage"),a=document.getElementById("modalMeta"),r=document.getElementById("typeChips");t.textContent="Loading…",o.src="",a.textContent="",r.innerHTML="",n(e).then(()=>{currentPokemon=e,t.textContent=capitalize(e.name),o.src=e.bigImgUrl||e.imgUrl||"",o.alt=e.name;const n=null!=e.height?e.height:"?",i=null!=e.weight?e.weight:"?";a.textContent=`Height: ${n}  •  Weight: ${i}`,r.innerHTML="",(e.types||[]).forEach(e=>{const t=document.createElement("span");t.className=`badge rounded-pill px-3 py-2 me-1 mb-1 type-chip ${typeClass(e)}`,t.textContent=e,r.appendChild(t)}),play(SFX.open)})}}}(),gridEl=document.getElementById("pokemonGrid"),searchInput=document.getElementById("search");let soundOn=!0;const soundToggle=document.getElementById("soundToggle");if(soundToggle){const e=localStorage.getItem("soundOn");null!==e&&(soundOn="true"===e,soundToggle.checked=soundOn),soundToggle.addEventListener("change",e=>{soundOn=e.target.checked,localStorage.setItem("soundOn",String(soundOn))})}const SFX={hover:new Audio("assets/sounds/ui-hover.mp3"),open:new Audio("assets/sounds/ui-open.mp3"),catch:new Audio("assets/sounds/ui-catch.mp3"),fail:new Audio("assets/sounds/ui-fail.mp3")};function play(e){if(soundOn&&e)try{e.currentTime=0,e.play()}catch(e){}}function confettiBurst(e,t,n=18){const o=document.createElement("canvas");o.width=innerWidth,o.height=innerHeight,Object.assign(o.style,{position:"fixed",left:"0",top:"0",pointerEvents:"none",zIndex:"9999"}),document.body.appendChild(o);const a=o.getContext("2d"),r=Array.from({length:n}).map(()=>({x:e,y:t,vx:5*(2*Math.random()-1),vy:-6*Math.random()-4,g:.3,s:3+3*Math.random(),a:1,life:60+30*Math.random()}));let i=0;!function e(){a.clearRect(0,0,o.width,o.height),r.forEach(e=>{e.x+=e.vx,e.y+=e.vy,e.vy+=e.g,e.a-=.012,e.life--,a.globalAlpha=Math.max(e.a,0);const t=["#ff4757","#ffa502","#7bed9f","#70a1ff","#eccc68"];a.fillStyle=t[Math.floor(Math.random()*t.length)],a.fillRect(e.x,e.y,e.s,e.s)}),i++,i<120?requestAnimationFrame(e):o.remove()}()}function clearGrid(){gridEl&&(gridEl.innerHTML="")}function addGridCard(e){if(!gridEl)return;const t=document.createElement("div");t.className="pokemon-card",t.setAttribute("data-bs-toggle","modal"),t.setAttribute("data-bs-target","#pokemonModal");const n=document.createElement("img");n.src=e.imgUrl||"",n.alt=e.name;const o=document.createElement("h3");o.textContent=capitalize(e.name);const a=document.createElement("div");a.className="types",(e.types||[]).forEach(e=>{const t=document.createElement("span");t.className=`type-chip type-${e.toLowerCase()}`,t.textContent=e,a.appendChild(t)}),t.append(n,o,a),t.addEventListener("mouseenter",()=>play(SFX.hover)),t.addEventListener("click",()=>{pokemonRepository.showDetails(e)}),gridEl.appendChild(t)}function renderGrid(e){clearGrid(),e.forEach(e=>addGridCard(e))}Object.values(SFX).forEach(e=>{e.volume=.35,e.preload="auto"});let currentPokemon=null;const playCryBtn=document.getElementById("playCry");playCryBtn&&playCryBtn.addEventListener("click",()=>{if(!currentPokemon||!soundOn)return;const e=(currentPokemon.name||"").toLowerCase(),t=new Audio(`assets/sounds/${e}.mp3`);t.volume=.5;try{t.play()}catch(e){}});const catchBtn=document.getElementById("catchBtn");function capitalize(e){return e?e.charAt(0).toUpperCase()+e.slice(1):e}function typeClass(e){return`type-${String(e||"").toLowerCase()}`}catchBtn&&catchBtn.addEventListener("click",()=>{const e=catchBtn.getBoundingClientRect();confettiBurst(e.left+e.width/2,e.top),play(SFX.catch)}),searchInput&&searchInput.addEventListener("input",e=>{const t=e.target.value.trim().toLowerCase(),n=pokemonRepository.getAll();renderGrid(t?n.filter(e=>(e.name||"").toLowerCase().includes(t)):n)}),pokemonRepository.loadList().then(()=>{const e=pokemonRepository.getAll().map(e=>pokemonRepository.loadDetails(e).catch(()=>{}));Promise.all(e).then(()=>{renderGrid(pokemonRepository.getAll())})});